[
  {
    "objectID": "case_study.html",
    "href": "case_study.html",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "",
    "text": "Here, we display how to use the visualization method of indirect effects using a real-world example from Coroller-Chouraki et al. (2026) LINK. While the authors examined the effects of several putative causes of the abundance of Protocalliphora spp. in the nests of Tree Swallows breeding along a gradient of agricultural intensity, they focused on direct effects and neglected to formally quantify or visualize hypothesized indirect effects. Here, we apply our novel visualization procedure to two indirect effects linked to the reproductive timing of swallows and included in the DAG on which the aforementioned study was based. More details about the hypothesized causal links in the system and theoretical explanations for the indirect effects visualized here can be found in Coroller-Chouraki et al. (2026) and Bush-Beaupré et al. (2026) LINK.\nThe data for the case study can be downloaded here"
  },
  {
    "objectID": "case_study.html#load-packages",
    "href": "case_study.html#load-packages",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Load packages",
    "text": "Load packages\n\nlibrary(tidyverse)       # data manipulation and plotting\nlibrary(readxl)          # read excel files\nlibrary(glmmTMB)         # frequentist GLMMs\nlibrary(marginaleffects) # marginal predictions\nlibrary(patchwork)       # multiple plots\nlibrary(mgcv)            # GAMMs"
  },
  {
    "objectID": "case_study.html#dag-plotting-function",
    "href": "case_study.html#dag-plotting-function",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "DAG plotting function",
    "text": "DAG plotting function\n\n#' Create a DAG plot with rounded boxes and arrows\n#'\n#' @param labels Character vector of length 3 with names for Exposure, Mediator, Outcome\n#' @param arrow_labels Character vector of length 4 with labels for paths B, C, D, E (default: c(\"B\", \"C\", \"D\", \"E\"))\n#' @param box_colors Character vector of length 3 with hex colors for boxes (default: c(\"tomato4\", \"#2E8B57\", \"#1E90FF\"))\n#' @param arrow_color Color for arrows (default: \"#0F6670\")\n#' @return A ggplot object\ncreate_dag_plot &lt;- function(labels = c(\"Exposure\", \"Mediator\", \"Outcome\"),\n                           arrow_labels = c(\"B\", \"C\", \"D\", \"E\"),\n                           box_colors = c(\"tomato4\", \"#2E8B57\", \"#1E90FF\"),\n                           arrow_color = \"#0F6670\") {\n  \n  # Path diagram (DAG) — rounded boxes + arrows\n  # boxes: name, center x/y, width, height, border colour\n  # Using wider coordinate system (0-1.4 for x) to create rectangular plot\n  boxes &lt;- data.frame(\n    name = labels,\n    x = c(0.7, 0.25, 1.15),\n    y = c(0.8, 0.4, 0.4),\n    width = c(0.7, 0.6, 0.6),\n    height = c(0.14, 0.18, 0.18),\n    col = box_colors,\n    stringsAsFactors = FALSE\n  )\n  \n  # arrow head style\n  arr_closed &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"closed\")\n  arr_open &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"open\")\n  \n  # Draw arrows FIRST so they appear behind boxes\n  p &lt;- ggplot() + xlim(0.2, 1.4) + ylim(0.2, 0.9) + \n    # B: Exposure -&gt; Outcome (right, curved)\n    geom_curve(aes(x = 0.81, y = 0.74, xend = 1.15, yend = 0.5), \n               curvature = -0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # C: Exposure -&gt; Mediator (left, curved)\n    geom_curve(aes(x = 0.59, y = 0.74, xend = 0.25, yend = 0.5), \n               curvature = 0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # D: Mediator -&gt; Outcome (bottom, long curve)\n    geom_curve(aes(x = 0.25, y = 0.31, xend = 1.15, yend = 0.3), \n               curvature = 0.32, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # E: dashed indirect (Exposure -&gt; Outcome via dashed curved line)\n    geom_curve(aes(x = 0.62, y = 0.765, xend = 0.84, yend = 0.41), \n               curvature = 1.5, color = \"slategray3\", size = 1.2,  arrow = arr_closed)\n  \n  # Now draw boxes on top of arrows\n  for(i in seq_len(nrow(boxes))){\n    bx &lt;- boxes[i,]\n    xmin &lt;- bx$x - bx$width/2\n    xmax &lt;- bx$x + bx$width/2\n    ymin &lt;- bx$y - bx$height/2\n    ymax &lt;- bx$y + bx$height/2\n    \n    # draw a rounded rectangle as a grob and place it with annotation_custom\n    rr &lt;- grid::roundrectGrob(r = unit(0.2, \"snpc\"),\n            gp = grid::gpar(fill = \"white\", col = bx$col, lwd = 6))\n    p &lt;- p + annotation_custom(rr, xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax) +\n      annotate(\"text\", x = bx$x, y = bx$y, label = bx$name, \n               fontface = \"bold\", size = 5.5, colour = bx$col)\n  }\n  \n  # Add labels for arrows on top\n  p &lt;- p +\n    annotate(\"text\", x = 1.00, y = 0.62, label = arrow_labels[1], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.40, y = 0.62, label = arrow_labels[2], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.70, y = 0.27, label = arrow_labels[3], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.2, y = 0.7, label = arrow_labels[4], size = 6, fontface = \"bold\") +\n    coord_cartesian(clip = \"off\") +\n    theme_void()\n  \n  return(p)\n}"
  },
  {
    "objectID": "case_study.html#data",
    "href": "case_study.html#data",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Data",
    "text": "Data\n\ndata_protos &lt;- read_excel(\"data_indirecteffects.xlsx\") |&gt; \n  # scale the data (except comp1 comp2 as it was already centered between 0)\n  mutate( scl_cumulated_chicks = as.vector(scale(cumulated_chicks)),\n          scl_a1j1_p = as.vector(scale(a1j1_p)),\n          scl_a1j1_t = as.vector(scale(a1j1_t)),\n          scl_mean_t_protos = as.vector(scale(mean_t_protos)),\n          scl_mean_p_protos = as.vector(scale(mean_p_protos)),\n          scl_mean_t_bird = as.vector(scale(mean_t_bird)),\n          scl_mean_p_bird = as.vector(scale(mean_p_bird)),\n          scl_timing_clutch = as.vector(scale(timing_clutch)),\n          year = as.factor(year), \n          farm = as.factor(farm),\n          agemom = as.factor(agemom)) \n\nglimpse(data_protos)\n\nRows: 1,175\nColumns: 24\n$ idcouvee             &lt;dbl&gt; 6072049, 6072067, 6252031, 6312061, 6312097, 6432…\n$ farm                 &lt;fct&gt; 339, 339, 339, 339, 339, 339, 339, 339, 339, 339,…\n$ nichoir              &lt;dbl&gt; 20, 20, 29, 32, 32, 38, 41, 44, 44, 47, 47, 20, 2…\n$ year                 &lt;fct&gt; 2008, 2011, 2005, 2010, 2016, 2004, 2006, 2005, 2…\n$ mean_t_protos        &lt;dbl&gt; 19.21152, 19.99097, 21.56581, 17.86704, 21.44941,…\n$ mean_p_protos        &lt;dbl&gt; 4.412069, 3.313214, 3.259667, 4.749355, 2.857241,…\n$ mean_t_bird          &lt;dbl&gt; 18.95252, 19.44646, 20.88006, 17.77005, 21.32746,…\n$ mean_p_bird          &lt;dbl&gt; 3.886667, 3.565500, 3.312273, 4.907391, 3.408095,…\n$ a1j1_p               &lt;dbl&gt; 149.65, 277.90, 199.09, 150.80, 147.43, 206.36, 2…\n$ a1j1_t               &lt;dbl&gt; 556.945, 573.965, 520.830, 710.695, 477.120, 519.…\n$ timing_clutch        &lt;dbl&gt; 154, 166, 171, 154, 185, 171, 154, 154, 159, 190,…\n$ cumulated_chicks     &lt;dbl&gt; 126, 92, 87, 149, 69, 84, 88, 110, 92, 88, 110, 1…\n$ n_protos             &lt;dbl&gt; 31, 29, 1, 9, 2, 1, 5, 8, 25, 12, 2, 9, 70, 35, 6…\n$ comp1                &lt;dbl&gt; 1.7136893, 2.4615953, 1.9719222, 2.6452952, 2.648…\n$ comp2                &lt;dbl&gt; -0.39773502, 0.08269011, -0.51961803, 1.70980123,…\n$ agemom               &lt;fct&gt; ASY, SY, ASY, ASY, SY, ASY, ASY, ASY, ASY, ASY, A…\n$ scl_cumulated_chicks &lt;dbl&gt; 0.76339770, -0.26769764, -0.41932931, 1.46090337,…\n$ scl_a1j1_p           &lt;dbl&gt; -1.10439407, 1.79796415, 0.01445654, -1.07836902,…\n$ scl_a1j1_t           &lt;dbl&gt; 0.9545618, 1.2213581, 0.3884427, 3.3646632, -0.29…\n$ scl_mean_t_protos    &lt;dbl&gt; 0.72057902, 1.30824321, 2.49559694, -0.29309542, …\n$ scl_mean_p_protos    &lt;dbl&gt; 0.3450492, -0.5928678, -0.6385729, 0.6329363, -0.…\n$ scl_mean_t_bird      &lt;dbl&gt; 0.76920191, 1.10353351, 2.07389174, -0.03117221, …\n$ scl_mean_p_bird      &lt;dbl&gt; -0.005763027, -0.222595172, -0.393558782, 0.68336…\n$ scl_timing_clutch    &lt;dbl&gt; -1.023968550, 0.726086790, 1.455276515, -1.023968…\n\n\n\nMetadata\nidcouvee — Unique identifier for each clutch (nesting attempt). [anonymized]\nfarm — Farm or study site where the nest box is located. [anonymized]\nnichoir — Nest box identifier within a given farm. [anonymized]\nyear — Year in which the breeding attempt occurred.\nn_protos — Number of Protocalliphora spp. puparia (pupal cases) found in the nest at the end of the breeding season; used as a proxy of ectoparasite abundance.\ncumulated_chicks — Proxy for host availability for Protocalliphora larvae, calculated as the number of chicks multiplied by the number of days they remained in the nest.\nmean_t_bird — Mean air temperature (°C) during the period corresponding to the nestling stage of the host chicks. (From hatching to fledging or demise)\nmean_p_bird — Mean precipitation (mm) during the period corresponding to the nestling stage of the host chicks. (From hatching to fledging or demise)\nmean_t_protos — Mean air temperature (°C) during the time window relevant for Protocalliphora larvae development (the same window as for chicks +7 days).\nmean_p_protos — Mean precipitation (mm) during the time window relevant for Protocalliphora larvae development (the same window as for chicks +7 days).\na1j1_t — Cumulative sum of hourly degrees above 5 °C between April 1 and June 1 (thermal accumulation, proxy for early-season temperature conditions).\na1j1_p — Cumulative sum of hourly precipitation between April 1 and June 1 (proxy for early-season moisture conditions).\ntiming_clutch — Day of the year corresponding to the hatching date of the first chick in the clutch (proxy for breeding phenology).\ncomp1 — First component from the rPCA describing agricultural landscape composition. Positively correlated with maize and soybean cover. Negatively correlated with forage and tree cover. Explains ~79% of the variance in habitat composition.\ncomp2 — Second component from the rPCA describing agricultural landscape composition. Positively correlated with tree cover. Negatively correlated with forage cover. Explains ~17% of the variance in habitat composition.\nagemom — Age class of the Tree Swallow mother for the given clutch (2nd year = young adult; After 2nd year = older adult)."
  },
  {
    "objectID": "case_study.html#dag",
    "href": "case_study.html#dag",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "DAG",
    "text": "DAG\n\n\nCode\nDAG_2 &lt;- create_dag_plot(\n  labels = c(\"Hatching date\", \"Nestling-days\", \"Abundance\")\n) +\n  xlim(0.05, 1.4) +\n  theme(plot.margin = margin(t = 10, r = 10, b = 10, l = 10, unit = \"pt\"))\n  \nprint(DAG_2)"
  },
  {
    "objectID": "case_study.html#models",
    "href": "case_study.html#models",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Models",
    "text": "Models\n\nNestling-days ~ Hatching date (Mediator ~ Exposure)\n\nm_host &lt;- gam(data = data_protos, \n             formula = cumulated_chicks ~ \n                    s(year, bs = \"re\") + s(farm, by = year, bs = \"re\") + \n                    scl_a1j1_p + scl_a1j1_t + \n                   agemom +\n                 s(scl_timing_clutch) +                          \n                te(comp1, comp2)  + te(scl_mean_t_bird, scl_mean_p_bird), \n             family = gaussian(link = \"log\"), method =  \"REML\")\n\n\nPredictions\nWe need to unscale hatching date after generating the predictions for the prediction plot.\n\n# population effect prediction\np_hatchdate_nestdays &lt;- predictions(m_host, \n                            newdata = datagrid(scl_timing_clutch = \n                                               seq(from = min(data_protos$scl_timing_clutch), \n                                                   to = max(data_protos$scl_timing_clutch), \n                                                   by = 0.1)), \n                            exclude = c(\"s(farm)\",\"s(year)\")) \n\n# we obtained predictions, but need to unscale the explanatory variable \"timing_clutch\" \np_hatchdate_nestdays &lt;- p_hatchdate_nestdays |&gt;  \n  mutate(hatch_date = scl_timing_clutch * sd(data_protos$timing_clutch) + mean(data_protos$timing_clutch)) |&gt; \n  select(-c(year,farm))\n\n\n\nPrediction plot\n\nplot_hatchdate_nestdays &lt;- ggplot(data = p_hatchdate_nestdays, aes(x = hatch_date , y = estimate)) + \n  geom_ribbon(aes(ymax = conf.high , ymin = conf.low),alpha = 0.05)+  \n  geom_line( linewidth = 1.5, lineend = \"round\") + \n  geom_segment(y= min(p_hatchdate_nestdays$estimate),\n                                   x = 0, xend= max(p_hatchdate_nestdays$hatch_date), linetype= \"dashed\") +\n  geom_segment(y=max(p_hatchdate_nestdays$estimate), x = 0, xend= min(p_hatchdate_nestdays$hatch_date), linetype= \"dashed\") +\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Nestling-days\", x = \"Hatching date\") +\n  theme(axis.line.y = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.line.x = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"aquamarine4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\", size = 14)) +   \n  scale_y_continuous(breaks = seq(80, 120, by = 20)) +\n  scale_x_continuous(breaks = seq(140, 190, by = 15))+\n  coord_cartesian(xlim = c(140, 195))\n\nplot_hatchdate_nestdays\n\n\n\n\n\n\n\n\n\n\n\nProtocalliphora abundance ~ Hatching date + nestling-days (Outcome ~ Exposure + Mediator)\n\nm_protos &lt;- gam(data = data_protos, formula = n_protos ~ \n                    s(year, bs = \"re\") + s(farm, by = year, bs = \"re\") + \n                   scl_a1j1_t + scl_a1j1_p + \n                  s(scl_timing_clutch) + scl_cumulated_chicks + \n                 te(comp1,comp2) + te(scl_mean_t_protos, scl_mean_p_protos),\n              family = tw(link = \"log\"), method = \"REML\")\n\n\n\nProtocalliphora abundance ~ Hatching date (Outcome ~ Exposure)\n\nPredictions\n\np_hatchdate_protos &lt;- predictions(m_protos, newdata = \n                             datagrid(scl_timing_clutch = \n                                               seq(from = min(data_protos$scl_timing_clutch), \n                                                   to = max(data_protos$scl_timing_clutch), \n                                                   by = 0.1)), \n                             exclude = c(\"s(farm)\",\"s(year)\")) #population effect prediction\n\n#we got the predictions, but need to unscale the explanatory variable \"timing_clutch\"\np_hatchdate_protos &lt;- p_hatchdate_protos |&gt;  \n  mutate(hatch_date = scl_timing_clutch * sd(data_protos$timing_clutch) + mean(data_protos$timing_clutch)) |&gt; \n  select(-c(year,farm))\n\n\n\nPrediction plot\n\nplot_hatchdate_proto &lt;- ggplot(data = p_hatchdate_protos, aes(x = hatch_date , y = estimate)) + \n  geom_ribbon(aes(ymax = conf.high , ymin = conf.low),alpha = 0.05)+  \n  geom_line( linewidth = 1.5, lineend = \"round\") +\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Abundance\", x = \"Hatching date\") +\n  theme(axis.line.y = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                     length = unit(0.15, \"inches\"),\n                                     ends = \"last\", \n                                     type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\",  size = 14)) +\n  scale_y_continuous(breaks = seq(5,20, by = 5)) +\n  scale_x_continuous(breaks = seq(140, 190, by = 15)) +\n  coord_cartesian(xlim = c(140, 195))\n\n\nplot_hatchdate_proto\n\n\n\n\n\n\n\n\n\n\n\nProtocalliphora abundance ~ Nestling-days (Outcome ~ Mediator)\n\nPredictions\n\np_nestdays_protos &lt;- predictions(m_protos, newdata = \n                             datagrid(scl_cumulated_chicks = seq(from = min(data_protos$scl_cumulated_chicks), to = max(data_protos$scl_cumulated_chicks), by = 0.1)), exclude = c(\"s(farm)\",\"s(year)\")) #population effect prediction\n\n#we got the predictions, but need to unscale the explanatory variable \"cumulated_chics\" (=host availability)\np_nestdays_protos &lt;- p_nestdays_protos |&gt;  \n  mutate(cumulated_chicks = scl_cumulated_chicks * sd(data_protos$cumulated_chicks) + mean(data_protos$cumulated_chicks)) |&gt; select(-c(year, farm))\n\n\n\nPrediction plot\n\nplot_nestdays_protos &lt;- ggplot(data = p_nestdays_protos, aes(y = estimate, x = cumulated_chicks)) +\n  geom_line(linewidth = 1.5, lineend = \"round\") +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.05) +\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Abundance\", x = \"Nestling-days\") +\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"aquamarine4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\",  size = 14))+ \n    scale_y_continuous(breaks = seq(10,50, by = 20))+\n    scale_x_continuous(breaks = seq(25,175, by = 50))\n\nplot_nestdays_protos"
  },
  {
    "objectID": "case_study.html#indirect-effect",
    "href": "case_study.html#indirect-effect",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Indirect effect",
    "text": "Indirect effect\n\nPredictions\nWe need the nestling-days values as predicted by hatching date to predict the values of Protocalliphora abundance along that predicted range. Since nestling-days are scaled in the model, we need to scale the predicted values using the original dataset, obtain the predicted Protocalliphora values and convert back to the original scale.\n\np_ind_hatchdate_protos &lt;- predictions(m_protos, \n                         newdata = datagrid(\n                           scl_cumulated_chicks = (p_hatchdate_nestdays$estimate - mean(data_protos$cumulated_chicks)) / sd(data_protos$cumulated_chicks)), \n                         exclude = c(\"s(farm)\",\"s(year)\")) |&gt;\n  # unscale cumulated chicks                       \n  mutate(cumulated_chicks = scl_cumulated_chicks*sd(data_protos$cumulated_chicks) + mean(data_protos$cumulated_chicks)) |&gt; \n  # Add unscaled hatch_date from the prediction grid\n  left_join(p_hatchdate_nestdays |&gt; \n               select(estimate, hatch_date) |&gt;\n               rename(cumulated_chicks = estimate)) \n\n\n\nPrediction plot\n\nCOLS &lt;- alpha(colorRampPalette(c(\"seashell\",\"tomato3\"))(30),0.8)\n\nplot_ind_hatchdate_protos &lt;- plot_nestdays_protos + \n  geom_line(data = p_ind_hatchdate_protos, \n            aes(y = estimate, x = cumulated_chicks, color = hatch_date, \n                linewidth = hatch_date), lineend = \"round\") +\n  geom_segment(x=min(p_ind_hatchdate_protos$cumulated_chicks), y=0, yend= min(p_ind_hatchdate_protos$estimate), linetype= \"dashed\") +\n  geom_segment(x=max(p_ind_hatchdate_protos$cumulated_chicks), y=0, yend=max(p_ind_hatchdate_protos$estimate), linetype= \"dashed\") +\n  scale_color_gradientn(colours = COLS, name = \"Hatching date\") +\n  guides(linewidth = \"none\") +\n  theme(legend.position = \"inside\",\n  legend.key.size = unit(1.1, \"cm\"),\n        legend.position.inside = c(0.35, 0.7),\n        legend.direction = \"horizontal\",\n        legend.text = element_text(color = \"tomato4\", size = 12, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title = element_text(color = \"tomato4\",size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title.position = \"top\") +\n  scale_y_continuous(breaks = seq(10,50, by = 20))\n\nplot_ind_hatchdate_protos"
  },
  {
    "objectID": "case_study.html#publication-figure-2",
    "href": "case_study.html#publication-figure-2",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Publication Figure 2",
    "text": "Publication Figure 2\n\n# Create right column with B and C stacked\nright_col_top_2 &lt;- plot_hatchdate_proto /  plot_hatchdate_nestdays\n\n# Create layout: DAG on left, right column on right for rows 1-2\ntop_section_2 &lt;- (DAG_2 | right_col_top_2) + plot_layout(widths = c(1, 1))\n\n# Row 3 has two plots side by side\nrow3_2 &lt;- plot_nestdays_protos + plot_ind_hatchdate_protos + plot_layout(widths = c(0.7, 1))\n\n# Combine all\nfig_2 &lt;- top_section_2 / row3_2 + \n  plot_layout(heights = c(2, 1)) +\n  plot_annotation(tag_levels = 'A') &\n  theme(plot.tag = element_text(size = 16, face = \"bold\"))\n\nfig_2"
  },
  {
    "objectID": "case_study.html#dag-1",
    "href": "case_study.html#dag-1",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "DAG",
    "text": "DAG\n\n\nCode\nDAG_3 &lt;- create_dag_plot(\n  labels = c(\"Hatching date\", \"Temperature\", \"Abundance\")\n) +\n  xlim(0.05, 1.4) +\n  theme(plot.margin = margin(t = 10, r = 10, b = 10, l = 10, unit = \"pt\"))\n\nprint(DAG_3)"
  },
  {
    "objectID": "case_study.html#model",
    "href": "case_study.html#model",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Model",
    "text": "Model\nThe only model missing for this analysis is Temperature ~ Hatching date\n\nTemperature ~ Hatching date (Mediator ~ Exposure)\n\nm_temp &lt;- glmmTMB(mean_t_protos ~ timing_clutch + (1|year/farm), family = lognormal, data = data_protos)\n\n\nPredictions\n\npred_temp &lt;- predictions(m_temp, \n                         newdata = datagrid(timing_clutch = seq(from = min(data_protos$timing_clutch), to = max(data_protos$timing_clutch), length.out = 3000)), \n                         re.form = NA)\n\n\n\nPrediction Plot\n\nplot_hatchdate_temp &lt;- ggplot(data = pred_temp) +\n  geom_line(aes(y = estimate, x = timing_clutch), linewidth = 1.5, lineend = \"round\" ) +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = timing_clutch), alpha = 0.05) +\n  theme_classic() +\n  geom_segment(y= min(pred_temp$estimate),\n                                   x = 0, xend= min(pred_temp$timing_clutch), linetype= \"dashed\") +\n  geom_segment(y=max(pred_temp$estimate), x = 0, xend= max(pred_temp$timing_clutch), linetype= \"dashed\") +\n  labs(title = NULL,\n       y = \"Temperature (°C)\",\n       x = \"Hatching date\")+\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"aquamarine4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\", size = 14)) +\n    scale_x_continuous(breaks = seq(140, 190, by = 15)) +\n    scale_y_continuous(breaks = seq(17, 21, by =2)) +\n    coord_cartesian(xlim = c(140, 195))\n\nprint(plot_hatchdate_temp)"
  },
  {
    "objectID": "case_study.html#protocalliphora-abundance-temperature-outcome-mediator",
    "href": "case_study.html#protocalliphora-abundance-temperature-outcome-mediator",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Protocalliphora abundance ~ Temperature (Outcome ~ Mediator)",
    "text": "Protocalliphora abundance ~ Temperature (Outcome ~ Mediator)\n\nPredictions\n\npred_protos_t &lt;- predictions(m_protos, \n                         newdata = datagrid(\n                           scl_mean_t_protos = seq(from = min(data_protos$scl_mean_t_protos), to = max(data_protos$scl_mean_t_protos), length.out = 40)), \n                         exclude = c(\"s(farm)\",\"s(year)\")) |&gt;\n  mutate(mean_t_protos = scl_mean_t_protos*sd(data_protos$mean_t_protos) + mean(data_protos$mean_t_protos)) # unscale temp\n\n\n\nPrediction plot\n\nplot_abund_temp &lt;- ggplot(data = pred_protos_t) +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = mean_t_protos), alpha = 0.05) +\n  geom_line(aes(y = estimate, x = mean_t_protos), linewidth = 1.5) +\n  labs(title = \"\",\n    y = \"Abundance\",\n       x = \"Temperature (°C)\") +\n  theme_classic() +\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"aquamarine4\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", size = 14),\n        axis.text.y = element_text(face = \"bold\", size = 14))\nplot_abund_temp"
  },
  {
    "objectID": "case_study.html#indirect-effect-1",
    "href": "case_study.html#indirect-effect-1",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Indirect effect",
    "text": "Indirect effect\n\nPredictions\n\npred_protos_pt &lt;- predictions(m_protos, \n                         newdata = datagrid(\n                           scl_mean_t_protos = (pred_temp$estimate - mean(data_protos$mean_t_protos)) / sd(data_protos$mean_t_protos)), \n                         # scale predicted temp\n                         exclude = c(\"s(farm)\",\"s(year)\")) |&gt;\n  mutate(mean_t_protos = scl_mean_t_protos*sd(data_protos$mean_t_protos) + mean(data_protos$mean_t_protos)) |&gt; # unscale\n  mutate(timing_clutch = pred_temp$timing_clutch) # Add unscaled timing clutch\n\n\n\nPlot\n\nplot_ind_hatchdate_temp &lt;-  plot_abund_temp +  geom_line(data = pred_protos_pt, \n            aes(y = estimate, x = mean_t_protos, color = timing_clutch, \n                linewidth = timing_clutch), lineend = \"round\") + \n  geom_segment(x=min(pred_protos_pt$mean_t_protos), y=0, yend= min(pred_protos_pt$estimate), linetype= \"dashed\") +\n  geom_segment(x=max(pred_protos_pt$mean_t_protos), y=0, yend=max(pred_protos_pt$estimate), linetype= \"dashed\") +\n  labs(y = \"Abundance\", title = \"\", color = \"Hatching date\") + \n  scale_color_gradientn(colours = COLS) +\n  guides(linewidth = \"none\", color = guide_colorbar(title.position = \"top\", title.hjust = 0.5)) +\n  theme(legend.position = \"inside\",\n  legend.key.size = unit(1.1, \"cm\"),\n        legend.position.inside = c(0.35, 0.8),\n        legend.direction = \"horizontal\",\n        legend.text = element_text(color = \"tomato4\", size = 12, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title = element_text(color = \"tomato4\",size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title.position = \"top\") + \n  scale_y_continuous(breaks = seq(10,30, by = 10))\n\nplot_ind_hatchdate_temp"
  },
  {
    "objectID": "case_study.html#publication-figure-3",
    "href": "case_study.html#publication-figure-3",
    "title": "Case Study - Protocalliphora abundance in Tree Swallow nests",
    "section": "Publication Figure 3",
    "text": "Publication Figure 3\n\n# Create right column with B and C stacked\nright_col_top_3 &lt;- plot_hatchdate_proto /  plot_hatchdate_temp\n\n# Create layout: DAG on left, right column on right for rows 1-2\ntop_section_3 &lt;- (DAG_3 | right_col_top_3) + plot_layout(widths = c(1, 1))\n\n# Row 3 has two plots side by side\nrow3_3 &lt;- plot_abund_temp + plot_ind_hatchdate_temp + plot_layout(widths = c(0.7, 1))\n\n# Combine all\nfig_3 &lt;- top_section_3 / row3_3 + \n  plot_layout(heights = c(2, 1)) +\n  plot_annotation(tag_levels = 'A') &\n  theme(plot.tag = element_text(size = 16, face = \"bold\"))\n\nfig_3"
  },
  {
    "objectID": "simulations.html",
    "href": "simulations.html",
    "title": "Simulations",
    "section": "",
    "text": "Using simulations, we will explore how to visualize indirect effects when we have an exposure, mediator and outcome variable."
  },
  {
    "objectID": "simulations.html#load-packages",
    "href": "simulations.html#load-packages",
    "title": "Simulations",
    "section": "Load packages",
    "text": "Load packages\n\nlibrary(tidyverse)       # data manipulation and plotting\nlibrary(glmmTMB)         # frequentist GLMMs\nlibrary(patchwork)       # multiple plots\nlibrary(marginaleffects) # marginal predictions\n\nset.seed(333) # set seed to reproduce the simulations exactly"
  },
  {
    "objectID": "simulations.html#dag-plotting-function",
    "href": "simulations.html#dag-plotting-function",
    "title": "Simulations",
    "section": "DAG plotting function",
    "text": "DAG plotting function\n\n#' Create a DAG plot with rounded boxes and arrows\n#'\n#' @param labels Character vector of length 3 with names for Exposure, Mediator, Outcome\n#' @param arrow_labels Character vector of length 4 with labels for paths B, C, D, E (default: c(\"B\", \"C\", \"D\", \"E\"))\n#' @param box_colors Character vector of length 3 with hex colors for boxes (default: c(\"#B22222\", \"#2E8B57\", \"#1E90FF\"))\n#' @param arrow_color Color for arrows (default: \"#0F6670\")\n#' @return A ggplot object\ncreate_dag_plot &lt;- function(labels = c(\"Exposure\", \"Mediator\", \"Outcome\"),\n                           arrow_labels = c(\"B\", \"C\", \"D\", \"E\"),\n                           box_colors = c(\"tomato4\", \"#2E8B57\", \"#1E90FF\"),\n                           arrow_color = \"#0F6670\") {\n  \n  # Path diagram (DAG) — rounded boxes + arrows\n  # boxes: name, center x/y, width, height, border colour\n  # Using wider coordinate system (0-1.4 for x) to create rectangular plot\n  boxes &lt;- data.frame(\n    name = labels,\n    x = c(0.7, 0.25, 1.15),\n    y = c(0.8, 0.4, 0.4),\n    width = c(0.7, 0.6, 0.6),\n    height = c(0.14, 0.18, 0.18),\n    col = box_colors,\n    stringsAsFactors = FALSE\n  )\n  \n  # arrow head style\n  arr_closed &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"closed\")\n  arr_open &lt;- grid::arrow(length = unit(0.22, \"inches\"), type = \"open\")\n  \n  # Draw arrows FIRST so they appear behind boxes\n  p &lt;- ggplot() + xlim(0.2, 1.4) + ylim(0.2, 0.9) + \n    # B: Exposure -&gt; Outcome (right, curved)\n    geom_curve(aes(x = 0.81, y = 0.74, xend = 1.15, yend = 0.5), \n               curvature = -0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # C: Exposure -&gt; Mediator (left, curved)\n    geom_curve(aes(x = 0.59, y = 0.74, xend = 0.25, yend = 0.5), \n               curvature = 0.28, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # D: Mediator -&gt; Outcome (bottom, long curve)\n    geom_curve(aes(x = 0.25, y = 0.31, xend = 1.15, yend = 0.3), \n               curvature = 0.32, color = arrow_color, size = 1.4, arrow = arr_closed) +\n    # E: dashed indirect (Exposure -&gt; Outcome via dashed curved line)\n    geom_curve(aes(x = 0.62, y = 0.765, xend = 0.84, yend = 0.41), \n               curvature = 1.5, color = \"slategray3\", size = 1.2,  arrow = arr_closed)\n  \n  # Now draw boxes on top of arrows\n  for(i in seq_len(nrow(boxes))){\n    bx &lt;- boxes[i,]\n    xmin &lt;- bx$x - bx$width/2\n    xmax &lt;- bx$x + bx$width/2\n    ymin &lt;- bx$y - bx$height/2\n    ymax &lt;- bx$y + bx$height/2\n    \n    # draw a rounded rectangle as a grob and place it with annotation_custom\n    rr &lt;- grid::roundrectGrob(r = unit(0.2, \"snpc\"),\n            gp = grid::gpar(fill = \"white\", col = bx$col, lwd = 6))\n    p &lt;- p + annotation_custom(rr, xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax) +\n      annotate(\"text\", x = bx$x, y = bx$y, label = bx$name, \n               fontface = \"bold\", size = 6, colour = bx$col)\n  }\n  \n  # Add labels for arrows on top\n  p &lt;- p +\n    annotate(\"text\", x = 1.00, y = 0.62, label = arrow_labels[1], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.40, y = 0.62, label = arrow_labels[2], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.70, y = 0.27, label = arrow_labels[3], size = 6, fontface = \"bold\") +\n    annotate(\"text\", x = 0.2, y = 0.7, label = arrow_labels[4], size = 6, fontface = \"bold\") +\n    coord_cartesian(clip = \"off\") +\n    theme_void()\n  \n  return(p)\n}"
  },
  {
    "objectID": "simulations.html#data",
    "href": "simulations.html#data",
    "title": "Simulations",
    "section": "Data",
    "text": "Data\n\nn &lt;- 3000 # sample size\nE &lt;- rnorm(n, 0, 1) # define E as a Z-score\nM &lt;- rpois(n, exp(4 + 0.1*E)) # M is a poisson variable whose link is the log function so defining the coefficients using the inverse log (exponential)\nO &lt;- rbinom(n, size = 1, prob = plogis(-3 + 0.1*E + 0.05*M)) # O is a Bernoulli variable whose link is the logit so defining the coefficients using the inverse logit (plogis)\n\ndata &lt;- tibble(\n  E = E,\n  M = M,\n  O = O,\n  O_1 = 1 - O\n)\n\nhead(data)\n\n# A tibble: 6 × 4\n        E     M     O   O_1\n    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;\n1 -0.0828    44     0     1\n2  1.93      71     1     0\n3 -2.05      45     0     1\n4  0.278     58     0     1\n5 -1.53      43     0     1\n6 -0.269     62     0     1"
  },
  {
    "objectID": "simulations.html#models",
    "href": "simulations.html#models",
    "title": "Simulations",
    "section": "Models",
    "text": "Models\nWe need two models: one where we regress the Mediator as a function of the Exposure. A second where we regress the Outcome as a function of both the Mediator and Exposure. ### M ~ E\n\nmM_E &lt;- glmmTMB(M ~ E, family = poisson, data = data)\n\n\nO ~ E + M\n\nmO_EM &lt;- glmmTMB(cbind(O, O_1) ~ E + M, family = binomial, data = data)"
  },
  {
    "objectID": "simulations.html#predictions",
    "href": "simulations.html#predictions",
    "title": "Simulations",
    "section": "Predictions",
    "text": "Predictions\n\nM ~ E\n\npred_M_E &lt;- predictions(mM_E, vcov = TRUE, newdata = datagrid(E = seq(from = min(data$E), to = max(data$E), length.out = 3000))) # need many points for the visualisation of the indirect effect later on\nhead(pred_M_E)\n\n\n     E Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %\n -3.51     38.1      0.352 108   &lt;0.001 Inf  37.4   38.7\n -3.50     38.1      0.352 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 108   &lt;0.001 Inf  37.4   38.8\n -3.50     38.1      0.351 109   &lt;0.001 Inf  37.4   38.8\n\nType: response\n\n\n\nPlot\n\npM_E &lt;- ggplot(data = pred_M_E) +\n  geom_line(aes(y = estimate, x = E), \n            lineend = \"round\",\n            linewidth = 1.5) +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = E), \n              alpha = 0.2) +\n  geom_segment(y=min(pred_M_E$estimate), \n               x = min(pred_M_E$E)*1.3, \n               xend= min(pred_M_E$E), \n               linetype= \"dashed\") +\n  geom_segment(y=max(pred_M_E$estimate), \n               x = min(pred_M_E$E)*1.3, \n               xend= max(pred_M_E$E), \n               linetype= \"dashed\") +\n  scale_y_continuous(breaks = seq(from = 40, to = 80, by = 10))+\n  theme_classic() +\n  labs(title = NULL,\n       y = \"Mediator\",\n       x = \"Exposure\") + \n  coord_cartesian(xlim = c(-4,4)) +\n  theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.title.y = element_text(color = \"aquamarine4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", \n                                   size = 14),\n        axis.text.y = element_text(face = \"bold\", \n                                    \n                                   size = 14),\n        plot.title = element_text(size = 16)) \n\npM_E\n\n\n\n\n\n\n\n\n\n\n\nO ~ E + M\n\n\nDirect effect of E\n\npred_O_E &lt;- predictions(mO_EM, vcov = TRUE, newdata = datagrid(E = seq(from = min(data$E), to = max(data$E), length.out = 30)))\nhead(pred_O_E)\n\n\n     E Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 %\n -3.51    0.367     0.0399  9.21   &lt;0.001  64.8 0.289  0.445\n -3.26    0.373     0.0375  9.94   &lt;0.001  75.0 0.299  0.446\n -3.02    0.378     0.0351 10.78   &lt;0.001  87.6 0.309  0.447\n -2.77    0.383     0.0326 11.75   &lt;0.001 103.5 0.319  0.447\n -2.53    0.389     0.0302 12.89   &lt;0.001 123.9 0.330  0.448\n -2.29    0.394     0.0277 14.23   &lt;0.001 150.3 0.340  0.449\n\nType: response\n\n\n\nPlot\n\npO_E &lt;- ggplot(data = pred_O_E) +\n  geom_line(aes(y = estimate, x = E), linewidth = 1.5, lineend = \"round\") +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = E), alpha = 0.05) +\n  \n  theme_classic() +\n  labs(title = NULL,\n       y = \"Outcome\",\n       x = \"Exposure\") +\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"tomato4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"tomato4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.text.x = element_text(face = \"bold\", \n                                   size = 14),\n        axis.text.y = element_text(\n                                   face = \"bold\", \n                                   size = 14),\n        plot.title = element_text(size = 16))\npO_E \n\n\n\n\n\n\n\n\n\n\n\nDirect effect of M\n\npred_O_M &lt;- predictions(mO_EM, vcov = TRUE, newdata = datagrid(M = seq(from = min(data$M), to = max(data$M), length.out = 30)))\nhead(pred_O_M)\n\n\n    M Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 %\n 27.0    0.174     0.0216  8.06   &lt;0.001  50.3 0.132  0.216\n 29.3    0.191     0.0214  8.92   &lt;0.001  60.8 0.149  0.232\n 31.6    0.208     0.0209  9.94   &lt;0.001  74.9 0.167  0.249\n 33.9    0.227     0.0203 11.18   &lt;0.001  94.0 0.187  0.267\n 36.2    0.247     0.0194 12.72   &lt;0.001 120.7 0.209  0.285\n 38.6    0.268     0.0183 14.64   &lt;0.001 158.8 0.232  0.304\n\nType: response\n\n\n\nPlot\n\npO_M &lt;- ggplot(data = pred_O_M) +\n  geom_line(aes(y = estimate, x = M), linewidth = 1.5, lineend = \"round\") +\n  geom_ribbon(aes(ymin = conf.low, ymax = conf.high, x = M), alpha = 0.05) +\n  \n  theme_classic() +\n  labs(title = NULL,\n       y = \"Outcome\",\n       x = \"Mediator\") +\n    theme(axis.line.y = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"dodgerblue1\"),\n        axis.line.x = element_line(arrow = arrow(\n                                               length = unit(0.15, \"inches\"),\n                                               ends = \"last\", \n                                               type = \"closed\"),\n                                   linewidth = 1.5,\n                                   color = \"aquamarine4\"),\n        axis.ticks = element_blank(),\n        axis.title.x = element_text(color = \"aquamarine4\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.title.y = element_text(color = \"dodgerblue1\", \n                                    size = 16, \n                                    face = \"bold\", \n                                    family = \"\", \n                                    lineheight = 1.5),\n        axis.text.x = element_text(\n                                   face = \"bold\", \n                                   size = 14),\n        axis.text.y = element_text(face = \"bold\", \n                                   size = 14),\n        plot.title = element_text(size = 16))\npO_M\n\n\n\n\n\n\n\n\nSo this is the direct effect of M on O. But, remember that M is caused by E so it may be of interest to see how E affects O indirectly, through M.\n\n\n\nIndirect effect of E\n\npM_E\n\n\n\n\n\n\n\n\nThe next step is actually quite simple. We generate predictions for O as a function of the predictions of M ~ E\n\npred_O_EM &lt;- predictions(mO_EM, vcov = TRUE, newdata = datagrid(M = pred_M_E$estimate))\nhead(pred_O_EM)\n\n\n    M Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %\n 38.1    0.264     0.0186 14.2   &lt;0.001 149.5 0.227  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 149.6 0.227  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 149.8 0.228  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 150.0 0.228  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 150.1 0.228  0.300\n 38.1    0.264     0.0186 14.2   &lt;0.001 150.3 0.228  0.301\n\nType: response\n\n\nNow, we need the values of E that were associated with the predicted values of M\n\npred_O_ME &lt;- pred_O_EM |&gt;\n  select(-c(E)) |&gt; #remove E; it's set to its mean as we don't need it\n  mutate(E = pred_M_E$E)\n\nhead(pred_O_ME)\n\n\n Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %\n    0.264     0.0186 14.2   &lt;0.001 149.5 0.227  0.300\n    0.264     0.0186 14.2   &lt;0.001 149.6 0.227  0.300\n    0.264     0.0186 14.2   &lt;0.001 149.8 0.228  0.300\n    0.264     0.0186 14.2   &lt;0.001 150.0 0.228  0.300\n    0.264     0.0186 14.2   &lt;0.001 150.1 0.228  0.300\n    0.264     0.0186 14.2   &lt;0.001 150.3 0.228  0.301\n\n\nNow, we simply superimpose both graphs of O ~ M\n\nPlot\n\nCOLS &lt;- alpha(colorRampPalette(c(\"seashell\",\"tomato3\"))(30),0.8)\n\npO_ME &lt;- pO_M + geom_line(data = pred_O_ME, aes(x = M, y = estimate, color = E, linewidth = E), lineend = \"round\") +\n  geom_segment(x=min(pred_O_ME$M), y = 0, yend= min(pred_O_ME$estimate), linetype= \"dashed\") +\n  geom_segment(x=max(pred_O_ME$M), y = 0, yend= max(pred_O_ME$estimate), linetype= \"dashed\") +\n  labs(title = NULL) + \n  scale_color_gradientn(colours = COLS, name = \"Exposure\") +\n  guides(linewidth = \"none\") +\n  theme(legend.position = \"inside\",\n        legend.position.inside = c(0.3, 0.75),\n        legend.direction = \"horizontal\",\n        legend.text = element_text(color = \"tomato4\", size = 12, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title = element_text(color = \"tomato4\",size = 16, face = \"bold\", family = \"\", lineheight = 1.5),\n        legend.title.position = \"top\")\n\npO_ME"
  },
  {
    "objectID": "simulations.html#figure-for-publication",
    "href": "simulations.html#figure-for-publication",
    "title": "Simulations",
    "section": "Figure for publication",
    "text": "Figure for publication\n\n# Create right column with B and C stacked\nright_col_top &lt;- pO_E / pM_E\n\n# Create layout: DAG on left, right column on right for rows 1-2\ntop_section &lt;- (DAG_default | right_col_top) + plot_layout(widths = c(1, 1))\n\n# Row 3 has two plots side by side\nrow3 &lt;- pO_M + pO_ME + plot_layout(widths = c(0.7, 1))\n\n# Combine all\nfig_1 &lt;- top_section / row3 + \n  plot_layout(heights = c(2, 1)) +\n  plot_annotation(tag_levels = 'A') &\n  theme(plot.tag = element_text(size = 16, face = \"bold\"))\n\nfig_1"
  },
  {
    "objectID": "kallan_case_study.html",
    "href": "kallan_case_study.html",
    "title": "Case Study - Effects of snow cover characteristics and reproduction on body mass in bighorn sheep (Ovis canadensis)",
    "section": "",
    "text": "Here, we display the use of the visualization method for indirect effects with a real-world example of the carry-over effects of snow cover characteristics on subsequent spring and automn mass of bighorn sheep on Ram mountain (Alberta, CAN). The original article by Crémel et al. can be found at LINK. This use case is more complex than the ones presented in the original article describing the method (LINK) as there is more than one mediator involved and in some cases, the exposure interacts with a mediator and in another case, the exposure interacts with a mediator and both mediators interact with one-another. We will display how the visualization method can be used to make such complex relationships more intuitive to interpret.\nThe full DAGs for the three analyses we will be working here can be found below:\nTo better understand the DAGs and relationships, readers are referred to the original publication."
  },
  {
    "objectID": "kallan_case_study.html#load-packages",
    "href": "kallan_case_study.html#load-packages",
    "title": "Case Study - Effects of snow cover characteristics and reproduction on body mass in bighorn sheep (Ovis canadensis)",
    "section": "Load packages",
    "text": "Load packages\n\nlibrary(tidyverse)\nlibrary(brms)\nlibrary(cmdstanr)\nlibrary(tidybayes)\nlibrary(ggpubr)\nlibrary(marginaleffects)\nlibrary(splines)"
  },
  {
    "objectID": "kallan_case_study.html#load-data-and-models",
    "href": "kallan_case_study.html#load-data-and-models",
    "title": "Case Study - Effects of snow cover characteristics and reproduction on body mass in bighorn sheep (Ovis canadensis)",
    "section": "Load data and models",
    "text": "Load data and models\n\ndata_all &lt;- readRDS(\"mass_loss_data_all_Kallan_Cremel.rds\")\n\nglimpse(data_all)\n\nList of 6\n $ Data_lamb_scaled  : tibble [355 × 34] (S3: tbl_df/tbl/data.frame)\n  ..$ Yr               : num [1:355] 1982 1983 1984 1987 1994 ...\n  ..$ ID               : chr [1:355] \"10M\" \"10N\" \"10P\" \"10S\" ...\n  ..$ Sex              : chr [1:355] \"Male\" \"Male\" \"Female\" \"Male\" ...\n  ..$ Age              : int [1:355] 0 0 0 0 0 0 0 0 0 0 ...\n  ..$ Survival         : int [1:355] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Survival_summer  : int [1:355] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Reproduction     : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Neonatal_death   : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Weanning         : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Died_summer      : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ wtd114           : num [1:355] 0.512 0.787 0.833 2.419 0.742 ...\n  ..$ wtd12            : num [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ wtd22            : num [1:355] 8.51 9.57 9.89 12.88 NA ...\n  ..$ next_wtd12       : num [1:355] 33.2 34.1 31.9 38.4 32.9 ...\n  ..$ winter_loss      : num [1:355] -2.8583 -2.5378 -0.0788 0.4487 -1.4803 ...\n  ..$ Summer_gain      : num [1:355] 21.9 22 21.9 25.9 NA ...\n  ..$ lead_repro       : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Surv_neonat      : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ days_count       : num [1:355] 0.7475 0.8824 0.0734 -1.6793 -0.376 ...\n  ..$ avg_snow_depth   : num [1:355] -1.528 -0.379 0.315 -1.393 -1.419 ...\n  ..$ max_snow_depth   : num [1:355] 63 81.6 70 59.9 43.7 ...\n  ..$ median_snow_depth: num [1:355] 16.4 33.7 44.5 20.4 21.5 ...\n  ..$ avg_SWE          : num [1:355] 42.2 65.9 91.2 46.2 62.1 ...\n  ..$ max_SWE          : num [1:355] 157 177 167 142 201 ...\n  ..$ median_SWE       : num [1:355] 29.1 49.2 89.8 39.4 55.4 ...\n  ..$ avg_density      : num [1:355] 171 179 200 183 250 ...\n  ..$ max_density      : num [1:355] 653 348 394 351 646 ...\n  ..$ median_density   : num [1:355] -1.421 -1.171 0.312 -0.754 1.998 ...\n  ..$ Age_category     : chr [1:355] \"lamb\" \"lamb\" \"lamb\" \"lamb\" ...\n  ..$ pop_den          : num [1:355] -0.4828 -0.3981 -0.0169 0.5759 1.8041 ...\n  ..$ wtd114_next      : num [1:355] 57.4 57.7 48.9 56.5 50.6 ...\n  ..$ Age_next         : int [1:355] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ pop_den_next     : num [1:355] -0.4449 -0.0839 0.0766 0.6383 1.1999 ...\n  ..$ Yr_next          : num [1:355] 1983 1984 1985 1988 1995 ...\n $ Data_female_scaled: tibble [1,702 × 34] (S3: tbl_df/tbl/data.frame)\n  ..$ Yr               : num [1:1702] 1979 1979 1982 1983 1984 ...\n  ..$ ID               : chr [1:1702] \"10F\" \"10H\" \"10L\" \"10L\" ...\n  ..$ Sex              : chr [1:1702] \"Female\" \"Female\" \"Female\" \"Female\" ...\n  ..$ Age              : num [1:1702] -0.337 -0.936 -1.235 -0.936 -0.637 ...\n  ..$ Survival         : int [1:1702] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Survival_summer  : int [1:1702] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Reproduction     : int [1:1702] 1 0 NA 0 1 1 1 1 1 1 ...\n  ..$ Neonatal_death   : int [1:1702] 1 NA NA NA 1 1 1 1 1 1 ...\n  ..$ Weanning         : int [1:1702] 1 NA NA NA 1 1 1 1 1 1 ...\n  ..$ Died_summer      : int [1:1702] 1 NA NA NA 1 1 1 1 1 1 ...\n  ..$ wtd114           : num [1:1702] 0.550364 -0.000242 -1.578783 -0.238003 0.229354 ...\n  ..$ wtd12            : num [1:1702] 51.8 45.9 30.1 43.4 46.1 ...\n  ..$ wtd22            : num [1:1702] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ next_wtd12       : num [1:1702] 58.3 54.9 43.4 46.1 54.6 ...\n  ..$ winter_loss      : num [1:1702] 12.8 10.32 5.09 16.68 13.09 ...\n  ..$ Summer_gain      : num [1:1702] 19.3 19.4 18.5 19.3 21.6 ...\n  ..$ lead_repro       : int [1:1702] 1 1 0 1 1 1 1 1 1 1 ...\n  ..$ Surv_neonat      : int [1:1702] 0 1 NA 1 1 1 1 1 1 0 ...\n  ..$ days_count       : num [1:1702] -1.93 -1.93 0.786 0.922 0.107 ...\n  ..$ avg_snow_depth   : num [1:1702] -0.0489 -0.0489 -1.4783 -0.3684 0.3016 ...\n  ..$ max_snow_depth   : num [1:1702] 87.3 87.3 63 81.6 70 ...\n  ..$ median_snow_depth: num [1:1702] 31.8 31.8 16.4 33.7 44.5 ...\n  ..$ avg_SWE          : num [1:1702] 76.5 76.5 42.2 65.9 91.2 ...\n  ..$ max_SWE          : num [1:1702] 193 193 157 177 167 ...\n  ..$ median_SWE       : num [1:1702] 66.4 66.4 29.1 49.2 89.8 ...\n  ..$ avg_density      : num [1:1702] 185 185 171 179 200 ...\n  ..$ max_density      : num [1:1702] 489 489 653 348 394 ...\n  ..$ median_density   : num [1:1702] -0.815 -0.815 -1.531 -1.275 0.242 ...\n  ..$ Age_category     : chr [1:1702] \"3_7_yr\" \"2_yr\" \"yearling\" \"2_yr\" ...\n  ..$ pop_den          : num [1:1702] -0.856 -0.856 -0.782 -0.709 -0.38 ...\n  ..$ wtd114_next      : num [1:1702] 70.4 64.6 62.7 67.7 69.8 ...\n  ..$ Age_next         : int [1:1702] 5 3 2 3 4 5 6 7 8 9 ...\n  ..$ pop_den_next     : num [1:1702] -0.895 -0.895 -0.714 -0.389 -0.245 ...\n  ..$ Yr_next          : num [1:1702] 1980 1980 1983 1984 1985 ...\n $ Data_male_scaled  : tibble [502 × 34] (S3: tbl_df/tbl/data.frame)\n  ..$ Yr               : num [1:502] 1979 1980 1981 1982 1983 ...\n  ..$ ID               : chr [1:502] \"10I\" \"10J\" \"10J\" \"10J\" ...\n  ..$ Sex              : chr [1:502] \"Male\" \"Male\" \"Male\" \"Male\" ...\n  ..$ Age              : num [1:502] -0.88 -0.88 -0.368 0.144 0.655 ...\n  ..$ Survival         : int [1:502] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Survival_summer  : int [1:502] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Reproduction     : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Neonatal_death   : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Weanning         : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Died_summer      : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ wtd114           : num [1:502] -0.716 -0.598 0.483 1.195 1.87 ...\n  ..$ wtd12            : num [1:502] 34.1 36.9 61.8 70.7 81 ...\n  ..$ wtd22            : num [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ next_wtd12       : num [1:502] 55.9 61.8 70.7 81 76.6 ...\n  ..$ winter_loss      : num [1:502] 1.42 -1.94 12.68 17.88 36.97 ...\n  ..$ Summer_gain      : num [1:502] 23.2 23 21.6 28.2 32.6 ...\n  ..$ lead_repro       : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Surv_neonat      : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ days_count       : num [1:502] -2.3208 0.8448 -0.0673 0.8984 1.0594 ...\n  ..$ avg_snow_depth   : num [1:502] -0.127 -1.004 -1.249 -1.478 -0.429 ...\n  ..$ max_snow_depth   : num [1:502] 87.3 63.8 73.2 63 81.6 ...\n  ..$ median_snow_depth: num [1:502] 31.8 32.38 9.59 16.42 33.73 ...\n  ..$ avg_SWE          : num [1:502] 76.5 68.4 50.1 42.2 65.9 ...\n  ..$ max_SWE          : num [1:502] 193 177 161 157 177 ...\n  ..$ median_SWE       : num [1:502] 66.4 78.4 16.2 29.1 49.2 ...\n  ..$ avg_density      : num [1:502] 185 208 172 171 179 ...\n  ..$ max_density      : num [1:502] 489 383 368 653 348 ...\n  ..$ median_density   : num [1:502] -0.752 1.558 -1.099 -1.432 -1.189 ...\n  ..$ Age_category     : chr [1:502] \"yearling\" \"yearling\" \"2_yr\" \"3_7_yr\" ...\n  ..$ pop_den          : num [1:502] -0.668 -0.705 -0.778 -0.595 -0.521 ...\n  ..$ wtd114_next      : num [1:502] 77.6 83.4 98.9 113.6 132.5 ...\n  ..$ Age_next         : int [1:502] 2 2 3 4 5 2 3 2 3 4 ...\n  ..$ pop_den_next     : num [1:502] -0.719 -0.792 -0.61 -0.537 -0.208 ...\n  ..$ Yr_next          : num [1:502] 1980 1981 1982 1983 1984 ...\n $ Data_lambs_uns    : tibble [355 × 34] (S3: tbl_df/tbl/data.frame)\n  ..$ Yr               : num [1:355] 1982 1983 1984 1987 1994 ...\n  ..$ ID               : chr [1:355] \"10M\" \"10N\" \"10P\" \"10S\" ...\n  ..$ Sex              : chr [1:355] \"Male\" \"Male\" \"Female\" \"Male\" ...\n  ..$ Age              : int [1:355] 0 0 0 0 0 0 0 0 0 0 ...\n  ..$ Survival         : int [1:355] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Survival_summer  : int [1:355] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Reproduction     : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Neonatal_death   : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Weanning         : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Died_summer      : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ wtd114           : num [1:355] 30.4 31.6 31.8 38.8 31.4 ...\n  ..$ wtd12            : num [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ wtd22            : num [1:355] 8.51 9.57 9.89 12.88 NA ...\n  ..$ next_wtd12       : num [1:355] 33.2 34.1 31.9 38.4 32.9 ...\n  ..$ winter_loss      : num [1:355] -2.8583 -2.5378 -0.0788 0.4487 -1.4803 ...\n  ..$ Summer_gain      : num [1:355] 21.9 22 21.9 25.9 NA ...\n  ..$ lead_repro       : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Surv_neonat      : int [1:355] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ days_count       : int [1:355] 252 255 237 198 227 234 255 229 192 251 ...\n  ..$ avg_snow_depth   : num [1:355] 20.3 32.9 40.5 21.8 21.5 ...\n  ..$ max_snow_depth   : num [1:355] 63 81.6 70 59.9 43.7 ...\n  ..$ median_snow_depth: num [1:355] 16.4 33.7 44.5 20.4 21.5 ...\n  ..$ avg_SWE          : num [1:355] 42.2 65.9 91.2 46.2 62.1 ...\n  ..$ max_SWE          : num [1:355] 157 177 167 142 201 ...\n  ..$ median_SWE       : num [1:355] 29.1 49.2 89.8 39.4 55.4 ...\n  ..$ avg_density      : num [1:355] 171 179 200 183 250 ...\n  ..$ max_density      : num [1:355] 653 348 394 351 646 ...\n  ..$ median_density   : num [1:355] 185 190 221 199 256 ...\n  ..$ Age_category     : chr [1:355] \"lamb\" \"lamb\" \"lamb\" \"lamb\" ...\n  ..$ pop_den          : int [1:355] 36 38 47 61 90 31 38 58 34 33 ...\n  ..$ wtd114_next      : num [1:355] 57.4 57.7 48.9 56.5 50.6 ...\n  ..$ Age_next         : int [1:355] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ pop_den_next     : int [1:355] 38 47 51 65 79 36 47 61 33 31 ...\n  ..$ Yr_next          : num [1:355] 1983 1984 1985 1988 1995 ...\n $ Data_females_uns  : tibble [1,702 × 34] (S3: tbl_df/tbl/data.frame)\n  ..$ Yr               : num [1:1702] 1979 1979 1982 1983 1984 ...\n  ..$ ID               : chr [1:1702] \"10F\" \"10H\" \"10L\" \"10L\" ...\n  ..$ Sex              : chr [1:1702] \"Female\" \"Female\" \"Female\" \"Female\" ...\n  ..$ Age              : int [1:1702] 4 2 1 2 3 4 5 6 7 8 ...\n  ..$ Survival         : int [1:1702] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Survival_summer  : int [1:1702] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Reproduction     : int [1:1702] 1 0 NA 0 1 1 1 1 1 1 ...\n  ..$ Neonatal_death   : int [1:1702] 1 NA NA NA 1 1 1 1 1 1 ...\n  ..$ Weanning         : int [1:1702] 1 NA NA NA 1 1 1 1 1 1 ...\n  ..$ Died_summer      : int [1:1702] 1 NA NA NA 1 1 1 1 1 1 ...\n  ..$ wtd114           : num [1:1702] 71.1 65.3 48.5 62.7 67.7 ...\n  ..$ wtd12            : num [1:1702] 51.8 45.9 30.1 43.4 46.1 ...\n  ..$ wtd22            : num [1:1702] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ next_wtd12       : num [1:1702] 58.3 54.9 43.4 46.1 54.6 ...\n  ..$ winter_loss      : num [1:1702] 12.8 10.32 5.09 16.68 13.09 ...\n  ..$ Summer_gain      : num [1:1702] 19.3 19.4 18.5 19.3 21.6 ...\n  ..$ lead_repro       : int [1:1702] 1 1 0 1 1 1 1 1 1 1 ...\n  ..$ Surv_neonat      : int [1:1702] 0 1 NA 1 1 1 1 1 1 0 ...\n  ..$ days_count       : int [1:1702] 192 192 252 255 237 262 229 198 232 268 ...\n  ..$ avg_snow_depth   : num [1:1702] 36.5 36.5 20.3 32.9 40.5 ...\n  ..$ max_snow_depth   : num [1:1702] 87.3 87.3 63 81.6 70 ...\n  ..$ median_snow_depth: num [1:1702] 31.8 31.8 16.4 33.7 44.5 ...\n  ..$ avg_SWE          : num [1:1702] 76.5 76.5 42.2 65.9 91.2 ...\n  ..$ max_SWE          : num [1:1702] 193 193 157 177 167 ...\n  ..$ median_SWE       : num [1:1702] 66.4 66.4 29.1 49.2 89.8 ...\n  ..$ avg_density      : num [1:1702] 185 185 171 179 200 ...\n  ..$ max_density      : num [1:1702] 489 489 653 348 394 ...\n  ..$ median_density   : num [1:1702] 200 200 185 190 221 ...\n  ..$ Age_category     : chr [1:1702] \"3_7_yr\" \"2_yr\" \"yearling\" \"2_yr\" ...\n  ..$ pop_den          : int [1:1702] 34 34 36 38 47 51 58 61 65 72 ...\n  ..$ wtd114_next      : num [1:1702] 70.4 64.6 62.7 67.7 69.8 ...\n  ..$ Age_next         : int [1:1702] 5 3 2 3 4 5 6 7 8 9 ...\n  ..$ pop_den_next     : int [1:1702] 33 33 38 47 51 58 61 65 72 83 ...\n  ..$ Yr_next          : num [1:1702] 1980 1980 1983 1984 1985 ...\n $ Data_males_uns    : tibble [502 × 34] (S3: tbl_df/tbl/data.frame)\n  ..$ Yr               : num [1:502] 1979 1980 1981 1982 1983 ...\n  ..$ ID               : chr [1:502] \"10I\" \"10J\" \"10J\" \"10J\" ...\n  ..$ Sex              : chr [1:502] \"Male\" \"Male\" \"Male\" \"Male\" ...\n  ..$ Age              : int [1:502] 1 1 2 3 4 1 2 1 2 3 ...\n  ..$ Survival         : int [1:502] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Survival_summer  : int [1:502] 1 1 1 1 1 1 1 1 1 1 ...\n  ..$ Reproduction     : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Neonatal_death   : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Weanning         : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Died_summer      : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ wtd114           : num [1:502] 57.3 59.9 83.4 98.9 113.6 ...\n  ..$ wtd12            : num [1:502] 34.1 36.9 61.8 70.7 81 ...\n  ..$ wtd22            : num [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ next_wtd12       : num [1:502] 55.9 61.8 70.7 81 76.6 ...\n  ..$ winter_loss      : num [1:502] 1.42 -1.94 12.68 17.88 36.97 ...\n  ..$ Summer_gain      : num [1:502] 23.2 23 21.6 28.2 32.6 ...\n  ..$ lead_repro       : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ Surv_neonat      : int [1:502] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ days_count       : int [1:502] 192 251 234 252 255 255 237 237 262 229 ...\n  ..$ avg_snow_depth   : num [1:502] 36.5 26 23 20.3 32.9 ...\n  ..$ max_snow_depth   : num [1:502] 87.3 63.8 73.2 63 81.6 ...\n  ..$ median_snow_depth: num [1:502] 31.8 32.38 9.59 16.42 33.73 ...\n  ..$ avg_SWE          : num [1:502] 76.5 68.4 50.1 42.2 65.9 ...\n  ..$ max_SWE          : num [1:502] 193 177 161 157 177 ...\n  ..$ median_SWE       : num [1:502] 66.4 78.4 16.2 29.1 49.2 ...\n  ..$ avg_density      : num [1:502] 185 208 172 171 179 ...\n  ..$ max_density      : num [1:502] 489 383 368 653 348 ...\n  ..$ median_density   : num [1:502] 200 249 192 185 190 ...\n  ..$ Age_category     : chr [1:502] \"yearling\" \"yearling\" \"2_yr\" \"3_7_yr\" ...\n  ..$ pop_den          : int [1:502] 34 33 31 36 38 38 47 47 51 58 ...\n  ..$ wtd114_next      : num [1:502] 77.6 83.4 98.9 113.6 132.5 ...\n  ..$ Age_next         : int [1:502] 2 2 3 4 5 2 3 2 3 4 ...\n  ..$ pop_den_next     : int [1:502] 33 31 36 38 47 47 51 51 58 61 ...\n  ..$ Yr_next          : num [1:502] 1980 1981 1982 1983 1984 ...\n\n# Female data and model\n## data\nData_females_uns &lt;- data_all$Data_females_uns \n\nglimpse(Data_females_uns)\n\nRows: 1,702\nColumns: 34\n$ Yr                &lt;dbl&gt; 1979, 1979, 1982, 1983, 1984, 1985, 1986, 1987, 1988…\n$ ID                &lt;chr&gt; \"10F\", \"10H\", \"10L\", \"10L\", \"10L\", \"10L\", \"10L\", \"10…\n$ Sex               &lt;chr&gt; \"Female\", \"Female\", \"Female\", \"Female\", \"Female\", \"F…\n$ Age               &lt;int&gt; 4, 2, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 1, 2, 3, 4,…\n$ Survival          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ Survival_summer   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ Reproduction      &lt;int&gt; 1, 0, NA, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, NA, 0, 1, 1,…\n$ Neonatal_death    &lt;int&gt; 1, NA, NA, NA, 1, 1, 1, 1, 1, 1, 0, 1, 0, NA, NA, 1,…\n$ Weanning          &lt;int&gt; 1, NA, NA, NA, 1, 1, 1, 1, 1, 1, 0, 1, 0, NA, NA, 1,…\n$ Died_summer       &lt;int&gt; 1, NA, NA, NA, 1, 1, 1, 1, 1, 1, NA, 1, NA, NA, NA, …\n$ wtd114            &lt;dbl&gt; 71.10219, 65.26287, 48.52202, 62.74134, 67.69779, 69…\n$ wtd12             &lt;dbl&gt; 51.83025, 45.91122, 30.06751, 43.42982, 46.06105, 54…\n$ wtd22             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ next_wtd12        &lt;dbl&gt; 58.30568, 54.94286, 43.42982, 46.06105, 54.61245, 53…\n$ winter_loss       &lt;dbl&gt; 12.796513, 10.320005, 5.092209, 16.680293, 13.085340…\n$ Summer_gain       &lt;dbl&gt; 19.271943, 19.351643, 18.454517, 19.311527, 21.63674…\n$ lead_repro        &lt;int&gt; 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1…\n$ Surv_neonat       &lt;int&gt; 0, 1, NA, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, NA, 1, 1, 1,…\n$ days_count        &lt;int&gt; 192, 192, 252, 255, 237, 262, 229, 198, 232, 268, 22…\n$ avg_snow_depth    &lt;dbl&gt; 36.52077, 36.52077, 20.30023, 32.89469, 40.49845, 28…\n$ max_snow_depth    &lt;dbl&gt; 87.31750, 87.31750, 62.95583, 81.56833, 69.97708, 70…\n$ median_snow_depth &lt;dbl&gt; 31.79854, 31.79854, 16.41833, 33.73167, 44.54708, 30…\n$ avg_SWE           &lt;dbl&gt; 76.48506, 76.48506, 42.21045, 65.90689, 91.18125, 70…\n$ max_SWE           &lt;dbl&gt; 193.0926, 193.0926, 157.2563, 177.1885, 166.6923, 16…\n$ median_SWE        &lt;dbl&gt; 66.44081, 66.44081, 29.13375, 49.22731, 89.81070, 76…\n$ avg_density       &lt;dbl&gt; 184.9853, 184.9853, 171.4015, 178.8097, 200.2655, 23…\n$ max_density       &lt;dbl&gt; 488.9118, 488.9118, 653.3644, 348.1430, 394.1615, 42…\n$ median_density    &lt;dbl&gt; 199.7442, 199.7442, 185.2718, 190.4476, 221.1253, 24…\n$ Age_category      &lt;chr&gt; \"3_7_yr\", \"2_yr\", \"yearling\", \"2_yr\", \"3_7_yr\", \"3_7…\n$ pop_den           &lt;int&gt; 34, 34, 36, 38, 47, 51, 58, 61, 65, 72, 83, 97, 103,…\n$ wtd114_next       &lt;dbl&gt; 70.40834, 64.64608, 62.74134, 67.69779, 69.80068, 67…\n$ Age_next          &lt;int&gt; 5, 3, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 2, 3, 4, 5…\n$ pop_den_next      &lt;int&gt; 33, 33, 38, 47, 51, 58, 61, 65, 72, 83, 97, 103, 97,…\n$ Yr_next           &lt;dbl&gt; 1980, 1980, 1983, 1984, 1985, 1986, 1987, 1988, 1989…\n\n## Model\nMass_loss_female_repro_int &lt;- readRDS(\"Mass_loss_female_repro_int_uns_Kallan_Cremel.rds\")"
  },
  {
    "objectID": "kallan_case_study.html#spring-mass-snow-reproductive-status",
    "href": "kallan_case_study.html#spring-mass-snow-reproductive-status",
    "title": "Case Study - Effects of snow cover characteristics and reproduction on body mass in bighorn sheep (Ovis canadensis)",
    "section": "Spring mass ~ Snow * Reproductive status",
    "text": "Spring mass ~ Snow * Reproductive status\n\ncol_repro &lt;- c(\"Non-reproductive\" = \"#d95f02\", \"Reproductive\" = \"#2ca25f\")\n\np_smass_snow &lt;- predictions(Mass_loss_female_repro_int,\n                           newdata = datagrid(avg_snow_depth = seq(from = min(Data_females_uns$avg_snow_depth),\n                                                                    to = max(Data_females_uns$avg_snow_depth),\n                                                                    by = 1),\n                                               lead_repro = c(0,1)),\n                           re_formula = NA,       # Population-level predictions\n                           type = \"response\",     # epred\n                           resp = \"nextwtd12\") |&gt; # spring mass\n               get_draws(shape = \"rvar\") |&gt;       # convert to rvar\n               mutate(Reproduction_status = factor(lead_repro, \n                                      levels = c(0, 1), \n                                      labels = c(\"Non-reproductive\", \"Reproductive\"))) \n\nLoading required namespace: rstan\n\nglimpse(p_smass_snow)\n\nRows: 90\nColumns: 21\n$ rowid               &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,…\n$ estimate            &lt;dbl&gt; 56.81431, 54.44444, 56.70474, 54.37151, 56.59131, …\n$ conf.low            &lt;dbl&gt; 55.01709, 52.74417, 54.97227, 52.74275, 54.93174, …\n$ conf.high           &lt;dbl&gt; 58.63699, 56.11609, 58.45741, 55.97621, 58.28095, …\n$ Age                 &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,…\n$ Age_next            &lt;int&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,…\n$ days_count          &lt;int&gt; 235, 235, 235, 235, 235, 235, 235, 235, 235, 235, …\n$ ID                  &lt;chr&gt; \"21I\", \"21I\", \"21I\", \"21I\", \"21I\", \"21I\", \"21I\", \"…\n$ median_density      &lt;dbl&gt; 216.2361, 216.2361, 216.2361, 216.2361, 216.2361, …\n$ next_wtd12          &lt;dbl&gt; 53.47249, 53.47249, 53.47249, 53.47249, 53.47249, …\n$ pop_den             &lt;int&gt; 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57…\n$ pop_den_next        &lt;int&gt; 58, 58, 58, 58, 58, 58, 58, 58, 58, 58, 58, 58, 58…\n$ wtd114              &lt;dbl&gt; 65.26543, 65.26543, 65.26543, 65.26543, 65.26543, …\n$ wtd114_next         &lt;dbl&gt; 68.65304, 68.65304, 68.65304, 68.65304, 68.65304, …\n$ Yr                  &lt;dbl&gt; 1991, 1991, 1991, 1991, 1991, 1991, 1991, 1991, 19…\n$ Yr_next             &lt;dbl&gt; 1992, 1992, 1992, 1992, 1992, 1992, 1992, 1992, 19…\n$ avg_snow_depth      &lt;dbl&gt; 19.98281, 19.98281, 20.98281, 20.98281, 21.98281, …\n$ lead_repro          &lt;dbl&gt; 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,…\n$ df                  &lt;dbl&gt; Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, …\n$ rvar                &lt;rvar[1d]&gt; 57 ± 0.92, 54 ± 0.86, 57 ± 0.88, 54 ± 0.82, 5…\n$ Reproduction_status &lt;fct&gt; Non-reproductive, Reproductive, Non-reproductive, …\n\nplot_smass_snow &lt;- ggplot(p_smass_snow, aes(x = avg_snow_depth, ydist = rvar, fill = Reproduction_status)) +\n  stat_lineribbon(aes(color = Reproduction_status, fill = Reproduction_status),\n                  .width = seq(0.5, 0.95, length.out = 20), \n                  alpha = 0.05) +\n  scale_color_manual(values = col_repro) +\n  scale_fill_manual(values = col_repro) +\n  labs(\n    x = \"Average snow depth (cm)\",\n    y = \"Spring mass (kg)\",\n    color = \"Reproduction status (t+1)\",\n    fill = \"Reproduction status (t+1)\"\n  ) +\n  theme_pubr() +\n  theme(legend.position = \"none\")\n\nplot_smass_snow"
  },
  {
    "objectID": "kallan_case_study.html#autumn-mass-spring-mass-reproductive-status",
    "href": "kallan_case_study.html#autumn-mass-spring-mass-reproductive-status",
    "title": "Case Study - Effects of snow cover characteristics and reproduction on body mass in bighorn sheep (Ovis canadensis)",
    "section": "Autumn mass ~ Spring mass * Reproductive status",
    "text": "Autumn mass ~ Spring mass * Reproductive status\n\np_amass_smass &lt;- predictions(Mass_loss_female_repro_int,\n                           newdata = datagrid(next_wtd12 = seq(from = min(Data_females_uns$next_wtd12),\n                                                                    to = max(Data_females_uns$next_wtd12),\n                                                                    by = 1),\n                                               lead_repro = c(0,1)),\n                           re_formula = NA,         # Population-level predictions\n                           type = \"response\",       # epred\n                           resp = \"wtd114next\") |&gt;  # autumn mass\n               get_draws(shape = \"rvar\") |&gt;         # convert to rvar\n               mutate(Reproduction_status = factor(lead_repro, \n                                      levels = c(0, 1), \n                                      labels = c(\"Non-reproductive\", \"Reproductive\"))) \n\nglimpse(p_amass_smass)\n\nRows: 104\nColumns: 21\n$ rowid               &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,…\n$ estimate            &lt;dbl&gt; 53.21183, 54.82918, 53.85450, 55.35583, 54.49930, …\n$ conf.low            &lt;dbl&gt; 51.48964, 53.30994, 52.17250, 53.87306, 52.86012, …\n$ conf.high           &lt;dbl&gt; 54.90691, 56.34843, 55.51482, 56.83880, 56.12220, …\n$ Age                 &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,…\n$ Age_next            &lt;int&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,…\n$ avg_snow_depth      &lt;dbl&gt; 37.07593, 37.07593, 37.07593, 37.07593, 37.07593, …\n$ days_count          &lt;int&gt; 235, 235, 235, 235, 235, 235, 235, 235, 235, 235, …\n$ ID                  &lt;chr&gt; \"21I\", \"21I\", \"21I\", \"21I\", \"21I\", \"21I\", \"21I\", \"…\n$ median_density      &lt;dbl&gt; 216.2361, 216.2361, 216.2361, 216.2361, 216.2361, …\n$ pop_den             &lt;int&gt; 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57…\n$ pop_den_next        &lt;int&gt; 58, 58, 58, 58, 58, 58, 58, 58, 58, 58, 58, 58, 58…\n$ wtd114              &lt;dbl&gt; 65.26543, 65.26543, 65.26543, 65.26543, 65.26543, …\n$ wtd114_next         &lt;dbl&gt; 68.65304, 68.65304, 68.65304, 68.65304, 68.65304, …\n$ Yr                  &lt;dbl&gt; 1991, 1991, 1991, 1991, 1991, 1991, 1991, 1991, 19…\n$ Yr_next             &lt;dbl&gt; 1992, 1992, 1992, 1992, 1992, 1992, 1992, 1992, 19…\n$ next_wtd12          &lt;dbl&gt; 25.46251, 25.46251, 26.46251, 26.46251, 27.46251, …\n$ lead_repro          &lt;dbl&gt; 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,…\n$ df                  &lt;dbl&gt; Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, Inf, …\n$ rvar                &lt;rvar[1d]&gt; 53 ± 0.87, 55 ± 0.77, 54 ± 0.85, 55 ± 0.76, 5…\n$ Reproduction_status &lt;fct&gt; Non-reproductive, Reproductive, Non-reproductive, …\n\nplot_amass_smass &lt;- ggplot() +\n  stat_lineribbon(data = p_amass_smass, aes(x = next_wtd12, ydist = rvar, fill = Reproduction_status),\n                  .width = seq(0.5, 0.95, length.out = 20), \n                  alpha = 0.05, color = \"black\") +\n  scale_fill_manual(values = col_repro) +\n  guides(fill = guide_legend(override.aes = list(alpha = 1, fill = NA, color = col_repro))) +\n  labs(\n    x = \"Spring mass (kg)\",\n    y = \"Autumn mass (kg)\",\n    fill = \"Reproduction status (t+1)\"\n  ) +\n  theme_pubr() +\n  theme(legend.position = \"inside\",\n        legend.position.inside = c(0.2, 0.8))\n\nplot_amass_smass"
  },
  {
    "objectID": "kallan_case_study.html#indirect-effect-of-snow-on-autumn-mass",
    "href": "kallan_case_study.html#indirect-effect-of-snow-on-autumn-mass",
    "title": "Case Study - Effects of snow cover characteristics and reproduction on body mass in bighorn sheep (Ovis canadensis)",
    "section": "Indirect effect of snow on autumn mass",
    "text": "Indirect effect of snow on autumn mass\n\nPredictions\nWe want to predict autumn mass from the predicted values of spring mass as a function of snow depth and reproductive status\n\n# the estimate column of p_smass_snow is the median of the posterior distribution\n# Let's simplify the prediction object to work with after\np_smass_snow |&gt; \n  as_tibble() |&gt; \n  select(estimate, avg_snow_depth, lead_repro) |&gt;\n  rename(next_wtd12 = estimate) -&gt; spring_mass_pred\n\n# Custom prediction grid\ndatagrid(model = Mass_loss_female_repro_int,\n         next_wtd12 = spring_mass_pred$next_wtd12) |&gt;\n  # need to add lead_repro separately as grid_type = \"dataframe\" argument throws an error\n  select(-lead_repro) |&gt;      \n  left_join(spring_mass_pred |&gt; select(next_wtd12, lead_repro)) -&gt; f_snow_indirect_pred_grid\n\nJoining with `by = join_by(next_wtd12)`\n\n# Predictions\np_ind_snow_smass &lt;- predictions(Mass_loss_female_repro_int,\n                           newdata = f_snow_indirect_pred_grid,\n                           re_formula = NA,         # Population-level predictions\n                           type = \"response\",       # epred\n                           resp = \"wtd114next\") |&gt;  # autumn mass\n                    mutate(Reproduction_status = factor(lead_repro, \n                                      levels = c(0, 1), \n                                      labels = c(\"Non-reproductive\", \"Reproductive\"))) |&gt;\n              # Add snow values from spring mass prediction grid\n                    select(-avg_snow_depth) |&gt;\n                    left_join(spring_mass_pred)\n\nJoining with `by = join_by(next_wtd12, lead_repro)`\n\n\n\n\nplot\n\nCOLS &lt;- alpha(colorRampPalette(c(\"#d0ddd6\",\"#47a6ddb7\"))(30),0.8)\n\nplot_amass_smass + \n  geom_line(data = p_ind_snow_smass, aes(x = next_wtd12, y = estimate, color = avg_snow_depth, linewidth = avg_snow_depth, group = Reproduction_status), lineend = \"round\") +\n  scale_color_gradientn(colours = COLS, name = \"Avg Snow Depth\") +\n  guides(linewidth = \"none\") +\n  theme(legend.direction = \"horizontal\")"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Extending the causal inference toolkit for ecologists: A visualization method of indirect effects",
    "section": "",
    "text": "Allen Bush-Beaupré1, Simon Coroller-Chouraki1, Marc Bélisle1,2\n1Université de Sherbrooke, Département de biologie, Sherbrooke, Canada\n2Centre d’étude de la forêt (CÉF)\nAllen Bush-Beaupré: allen.bush-beaupre@usherbrooke.ca | ORCID: 0000-0001-6989-9278\nSimon Coroller-Chouraki: ORCID: 0000-0001-8721-3727\nMarc Bélisle: ORCID: 0000-0003-0657-6724\n\nWelcome to the webpage dedicated to visualizing indirect effects for a wide scope of use cases in causal and network analyses. Being ecologists, we have focused on applying the visualization method we developed to examples in ecology. The method can however be applied to all fields of research in which indirect effects are of interest. By leveraging commonly used software such as marginaleffects and ggplot2, our method can be easily integrated into most analysis workflows.\n\n\n\n\nFigure 1.(A) Directed acyclic graph of a simulated example of the direct effect of an exposure variable on an outcome variable and its indirect effect through a mediator. (B) Prediction of the direct effect of the exposure on the outcome. (C) Prediction of the direct effect of the exposure on the mediator. (D) Prediction of the direct effect of the mediator on the outcome. (E) Prediction of the indirect effect of the exposure on the outcome superimposed on the prediction of the direct effect of the mediator on the outcome.\n\n\n\nAbstract\nMuch ecological research focuses on how a given variable can affect another either directly or indirectly through the effect of one or more intervening variables in the context of causal inference and network analyses. Various methods to quantify the magnitude of these effects are available but are difficult to interpret in a meaningful way. We propose a method of visualizing indirect effects by means of plotting model predictions of an outcome in the presence of exposure and mediator variables. We demonstrate the method through simulations and apply them to a real-world example involving Tree Swallows (Tachycineta bicolor) and their obligatory hematophagous ectoparasites, Protocalliphora spp. bird blowflies. The simple procedure using commonplace software should prove instrumental to visualize and interpret relationships among variables involved in ecological mechanisms and can be seamlessly integrated to analysts’ workflows.\n\nThis is the link towards the preprint of our article describing the method on Biorxiv.\nThis is the link to access and download the data used in the case study.\n\n\n\nWe use simulations to display the method with a simple use case in the Simulations tab. In the Case Study tab, we show how to use the visualization method in the case of real world data and models in which the predictor variables have been scaled. This adds a subtle layer of complexity to the procedure but the code should help overcome this."
  }
]